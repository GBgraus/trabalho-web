<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loja Tech - Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="StyleLogin.css">
</head>
<body>

  <header>
    <div class="container">
      <div class="grid">
        <div class="col-6">
          <a class="brand" href="#">
            <img src="img/logo.png" alt="Logo da Loja Tech" class="brand-logo">
             <strong>Loja Tech</strong>
          </a>
        </div>
        <div class="col-6" style="text-align:right">
          <a href="SobreNos.html" class="btn" id="btn-sobrenos">Sobre nós</a>
        </div>
      </div>
    </div>
  </header>

  <div class="box">
    <h2 id="formTitle">Login</h2>
    
    <div id="loginForm">
      <input id="emailLogin" placeholder="Email">
      <input id="senhaLogin" type="password" placeholder="Senha">
      <button onclick="login()">Entrar</button>
      <div class="toggle" onclick="mostrarCadastro()">Não tem conta? Cadastre-se</div>
    </div>
    
    <div id="cadastroForm" style="display:none">
      <input id="nomeCadastro" placeholder="Nome">
      <input id="emailCadastro" placeholder="Email">
      <input id="senhaCadastro" type="password" placeholder="Senha">

       <!-- login botão google -->

      <div id="g_id_onload"
     data-client_id="682813779819-rlmvn7u3jj9ikaqnqc0rknn8pasojcqj.apps.googleusercontent.com"
     data-context="signin"
     data-callback="handleCredentialResponse"
     data-auto_prompt="false">
</div>

<div class="g_id_signin" data-type="standard"></div>
      <select id="tipoUsuario">
        <option value="cliente">Cliente</option>
        <option value="admin">Administrador</option>
      </select>
      <button onclick="cadastrar()">Cadastrar</button>
      <div class="toggle" onclick="mostrarLogin()">Já tem conta? Entrar</div>
    </div>
  </div>

  <script>
    function mostrarCadastro(){
      document.getElementById("loginForm").style.display="none";
      document.getElementById("cadastroForm").style.display="block";
      document.getElementById("formTitle").innerText="Cadastro";
    }
    function mostrarLogin(){
      document.getElementById("loginForm").style.display="block";
      document.getElementById("cadastroForm").style.display="none";
      document.getElementById("formTitle").innerText="Login";
    }

    function cadastrar(){
      let nome = document.getElementById('nomeCadastro').value;
      let email = document.getElementById('emailCadastro').value;
      let senha = document.getElementById('senhaCadastro').value;
      let tipo = document.getElementById('tipoUsuario').value;

      let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      if(usuarios.find(u => u.email === email)){
        alert("Este email já está cadastrado!");
        return;
      }
      usuarios.push({nome,email,senha,tipo});
      localStorage.setItem('usuarios', JSON.stringify(usuarios));
      alert("Cadastro realizado! Agora faça login.");
      mostrarLogin();
    }

    function login(){
      let email = document.getElementById('emailLogin').value;
      let senha = document.getElementById('senhaLogin').value;
      let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
      let user = usuarios.find(u => u.email===email && u.senha===senha);

      if(user){
        localStorage.setItem('usuarioLogado', JSON.stringify(user));
        window.location.href = "Index.html"; // redireciona
      } else {
        alert("Usuário ou senha inválidos");
      }
    }
  </script>

<script>
  function handleCredentialResponse(response) {
    console.log("Credencial do Google:", response.credential);
    const user = parseJwt(response.credential);
    console.log(user);
    localStorage.setItem('usuarioLogado', JSON.stringify(user));
    // Redirecionar após login
    window.location.href = "Index.html";
  }

  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));

    return JSON.parse(jsonPayload);
  }
</script>

<footer>
  <div class="container">
    <div class="grid">
      <div class="col-6">
        <strong>Loja Tech</strong>
        <div class="note">CNPJ 00.000.000/0001-00 • Rua Exemplo, 123 — Centro</div>
        <div class="note">Atendimento: seg–sex 09:00–18:00, sáb 09:00–13:00</div>
      </div>
      <div class="col-6" style="text-align:right">
        <div class="note">© <span id="ano"></span> Loja Tech — Todos os direitos reservados</div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
