<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loja Tech — Eletrônicos & Informática + Assistência Técnica</title>
  <meta name="description" content="Loja de eletrônicos e informática com carrinho, checkout, agendamentos e painel admin (demo em HTML/JS com localStorage), conectada ao login."/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0b1220;
      --card: #10182b;
      --muted: #8892a6;
      --text: #e6ebf5;
      --primary: #6ee7f9; /* cyan */
      --primary-2: #7c3aed; /* violet */
      --accent: #22c55e; /* green */
      --danger: #ef4444;
      --warning: #f59e0b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:radial-gradient(1200px 800px at 80% -10%, rgba(124,58,237,.25), transparent 60%), linear-gradient(180deg, #0b1220 0%, #0b1220 60%, #0a1326 100%);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    /* Header */
    header{position:sticky;top:0;z-index:60;background:rgba(16,24,43,.75);backdrop-filter: blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .brand-logo{width:34px;height:34px;border-radius:10px;background: linear-gradient(135deg,var(--primary),var(--primary-2));display:grid;place-items:center;box-shadow: var(--shadow)}
    .brand-logo svg{filter: drop-shadow(0 4px 8px rgba(0,0,0,.3))}
    .nav-actions{display:flex;gap:10px;align-items:center}
    .search{position:relative;flex:1;max-width:520px}
    .search input{width:100%;padding:12px 46px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);color:var(--text);outline:none}
    .search svg{position:absolute;left:14px;top:50%;transform:translateY(-50%);opacity:.7}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.06);color:var(--text);cursor:pointer}
    .btn-primary{background: linear-gradient(135deg,var(--primary-2),var(--primary));color:#0b1220;border: none;font-weight:700}
    .btn-ghost{background:transparent}
    .btn-category{background:linear-gradient(135deg,var(--primary),var(--primary-2));color:#0b1220;border:none;font-weight:700}
    .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px;color:var(--muted)}

    /* Hero */
    .hero{padding:36px 0 8px}
    .hero-inner{display:grid;grid-template-columns: 1.4fr .6fr;gap:24px;align-items:center}
    .hero h1{font-size:38px;line-height:1.1;margin:0}
    .hero p{margin:10px 0 18px;color:var(--muted)}
    .hero-card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:20px;box-shadow: var(--shadow)}

    /* Sections & Grid */
    .section{padding:22px 0 38px}
    .section h2{font-size:24px;margin:0 0 14px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-3{grid-column: span 3}
    .col-4{grid-column: span 4}
    .col-6{grid-column: span 6}
    .col-12{grid-column: span 12}

    /* Product Card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .card-media{padding:14px;display:grid;place-items:center;background: radial-gradient(500px 200px at 50% -40%, rgba(110,231,249,.25), transparent 60%)}
    .card-content{padding:16px;display:flex;flex-direction:column;gap:10px}
    .price{font-weight:800;font-size:18px}
    .old-price{color:var(--muted);text-decoration:line-through;font-weight:500;margin-left:8px}
    .rating{font-size:12px;color:#fbbf24}
    .actions{display:flex;gap:8px;margin-top:auto}

    /* Services */
    .service-list{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .service{padding:16px;border-radius:var(--radius);border:1px dashed rgba(255,255,255,.12);background:rgba(255,255,255,.04)}

    /* Booking */
    .booking{display:grid;grid-template-columns: 1fr 1fr;gap:20px}
    form .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input, select, textarea{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:var(--text)}
    textarea{min-height:90px}
    .note{font-size:12px;color:var(--muted)}

    /* Drawer Cart */
    .cart-toggle{position:relative}
    .cart-count{position:absolute;top:-6px;right:-6px;background:var(--danger);color:white;border-radius:999px;padding:2px 6px;font-size:12px;font-weight:800}
    .drawer{position:fixed;right:20px;top:82px;bottom:20px;width:360px;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.12);border-radius:20px;box-shadow:var(--shadow);display:none;flex-direction:column;overflow:hidden;z-index:70}
    .drawer.open{display:flex}
    .drawer header{position:sticky;top:0;padding:14px 16px;background:transparent;border:none}
    .drawer .items{padding:6px 14px;display:flex;flex-direction:column;gap:10px;overflow:auto}
    .cart-item{display:flex;gap:10px;padding:10px;border-radius:12px;background:rgba(255,255,255,.05);align-items:center}
    .cart-item .meta{flex:1}
    .totals{margin-top:auto;padding:14px;border-top:1px solid rgba(255,255,255,.08);display:flex;justify-content:space-between;align-items:center}

    /* Dashboards */
    .board{display:grid;grid-template-columns:1fr 1fr;gap:16px}

    /* Footer */
    footer{border-top:1px solid rgba(255,255,255,.08);padding:30px 0;color:var(--muted)}

    /* Responsive */
    @media (max-width: 980px){
      .hero-inner{grid-template-columns:1fr}
      .booking{grid-template-columns:1fr}
      .service-list{grid-template-columns:1fr 1fr}
      .drawer{right:10px;left:10px;width:auto}
      .board{grid-template-columns:1fr}
    }
    @media (max-width: 720px){
      .grid{grid-template-columns:repeat(6,1fr)}
      .col-3{grid-column:span 6}
      .service-list{grid-template-columns:1fr}
      form .row{grid-template-columns:1fr}
    }

    /* Tiny animations */
    .fade-in{animation:fade .5s ease both}
    @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(0,0,0,.25)}
    .card:hover{transform:translateY(-3px);transition:.2s}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container nav">
      <a href="#" class="brand" aria-label="Página inicial">
        <span class="brand-logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3l8 4.5v9L12 21l-8-4.5v-9L12 3z" stroke="white" stroke-width="1.5" />
            <path d="M7 8l5 2.8 5-2.8" stroke="white" stroke-opacity=".6"/>
          </svg>
        </span>
        <span>Loja Tech</span>
      </a>
      <div class="search" role="search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 21l-4.3-4.3" stroke="white" stroke-opacity=".6" stroke-width="1.6" stroke-linecap="round"/>
          <circle cx="11" cy="11" r="7" stroke="white" stroke-opacity=".6" stroke-width="1.6"/>
        </svg>
        <label class="sr-only" for="busca">Buscar produtos</label>
        <input id="busca" placeholder="Buscar produtos... (ex: notebook, SSD, headset)" />
      </div>
      <div class="nav-actions">
        <button class="btn" id="btn-categorias">Categorias</button>
        <button class="btn" id="btn-servicos">Serviços</button>
        <button class="btn" id="btn-perfil" style="display:none">Meu Perfil</button>
        <button class="btn" id="btn-admin" style="display:none">Admin</button>
        <a href="Login.html"><button class="btn" id="btn-sair">Sair</button></a>
        <button class="btn btn-primary cart-toggle" id="btn-carrinho" aria-haspopup="dialog" aria-controls="drawer-carrinho">
          Carrinho <span class="cart-count" id="cart-count">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero container">
    <div class="hero-inner">
      <div class="hero-card fade-in">
        <div class="pill">Frete grátis acima de R$ 399 • 10x sem juros</div>
        <h1>Eletrônicos & Informática com <span style="background:linear-gradient(90deg,var(--primary),var(--primary-2));-webkit-background-clip:text;background-clip:text;color:transparent">atendimento técnico</span> especializado</h1>
        <p>Compre os melhores produtos e agende reparos, upgrades e formatações com horário marcado.</p>
        <div class="badges">
          <span class="pill">Garantia de 1 ano</span>
          <span class="pill">Retirada na loja</span>
          <span class="pill">Assistência autorizada</span>
        </div>
      </div>
      <div class="hero-card fade-in" style="display:grid;place-items:center">
        <svg width="300" height="180" viewBox="0 0 300 180" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g1" x1="0" x2="1"><stop offset="0%" stop-color="#7c3aed"/><stop offset="100%" stop-color="#6ee7f9"/></linearGradient>
          </defs>
          <rect x="0" y="0" width="300" height="180" rx="16" fill="rgba(255,255,255,.04)" stroke="rgba(255,255,255,.12)"/>
          <g transform="translate(20,20)">
            <rect x="0" y="0" width="110" height="70" rx="10" fill="url(#g1)" opacity=".8"/>
            <rect x="130" y="10" width="130" height="60" rx="10" fill="url(#g1)" opacity=".35"/>
            <rect x="0" y="90" width="260" height="16" rx="8" fill="url(#g1)" opacity=".3"/>
            <rect x="0" y="114" width="200" height="16" rx="8" fill="url(#g1)" opacity=".2"/>
          </g>
        </svg>
        <div class="note">Design ilustrativo do painel da loja</div>
      </div>
    </div>
  </section>

  <!-- Categorias -->
  <section class="section container" id="categorias">
    <h2>Categorias</h2>
    <div style="display:flex;flex-wrap:wrap;gap:10px" id="botoes-categorias">
      <button class="btn btn-category" data-cat="todos">Todos</button>
      <button class="btn btn-category" data-cat="notebooks">Notebooks</button>
      <button class="btn btn-category" data-cat="smartphones">Smartphones</button>
      <button class="btn btn-category" data-cat="perifericos">Periféricos</button>
      <button class="btn btn-category" data-cat="armazenamento">Armazenamento</button>
      <button class="btn btn-category" data-cat="redes">Redes</button>
    </div>
  </section>

  <!-- Produtos -->
  <section class="section container" id="produtos">
    <h2>Produtos em destaque</h2>
    <div class="grid" id="prod-grid"></div>
  </section>

  <!-- Serviços de Assistência Técnica -->
  <section class="section container" id="servicos">
    <h2>Assistência técnica</h2>
    <div class="service-list">
      <article class="service"><h3>Troca de tela</h3><p class="note">Peças originais e garantia</p></article>
      <article class="service"><h3>Upgrade de desempenho</h3><p class="note">SSD, RAM e otimizações</p></article>
      <article class="service"><h3>Formatação & Backup</h3><p class="note">Migração de dados e antivírus</p></article>
      <article class="service"><h3>Remoção de vírus</h3><p class="note">Limpeza e proteção</p></article>
      <article class="service"><h3>Instalação de software</h3><p class="note">Sistemas e drivers</p></article>
      <article class="service"><h3>Manutenção preventiva</h3><p class="note">Limpeza e testes</p></article>
    </div>
  </section>

  <!-- Agendamento -->
  <section class="section container" id="agendamento">
    <h2>Agende seu horário</h2>
    <div class="booking">
      <form id="form-agendamento" class="card" autocomplete="on">
        <div class="card-content">
          <div class="row">
            <div>
              <label for="tipo-servico">Serviço</label>
              <select id="tipo-servico" required>
                <option value="" disabled selected>Selecione</option>
                <option>Troca de tela</option>
                <option>Upgrade de SSD/RAM</option>
                <option>Formatação & Backup</option>
                <option>Remoção de vírus</option>
                <option>Instalação de software</option>
                <option>Manutenção preventiva</option>
                <option>Diagnóstico geral</option>
              </select>
            </div>
            <div>
              <label for="dispositivo">Dispositivo</label>
              <input id="dispositivo" placeholder="Ex: Notebook Lenovo, iPhone 13" required />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="data">Data</label>
              <input type="date" id="data" required />
            </div>
            <div>
              <label for="hora">Hora</label>
              <input type="time" id="hora" required />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="nome">Nome</label>
              <input id="nome" autocomplete="name" required />
            </div>
            <div>
              <label for="email">E-mail</label>
              <input type="email" id="email" autocomplete="email" required />
            </div>
          </div>
          <div>
            <label for="telefone">Telefone</label>
            <input id="telefone" placeholder="(xx) xxxxx-xxxx" autocomplete="tel" />
          </div>
          <div>
            <label for="detalhes">Detalhes (opcional)</label>
            <textarea id="detalhes" placeholder="Descreva o problema"></textarea>
          </div>
          <div class="note">Horários úteis: seg–sex 09:00–18:00. Não atendemos aos domingos.</div>
          <div class="actions">
            <button type="submit" class="btn btn-primary">Confirmar agendamento</button>
            <button type="reset" class="btn">Limpar</button>
          </div>
        </div>
      </form>
      <div class="card">
        <div class="card-content">
          <h3>Seus próximos agendamentos</h3>
          <div id="lista-agendamentos" class="note">Nenhum agendamento ainda.</div>
          <div class="actions" style="margin-top:12px">
            <button class="btn" id="btn-exportar">Exportar (.ics)</button>
            <button class="btn" id="btn-limpar-ag">Limpar lista</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Carrinho (drawer) -->
  <aside class="drawer" id="drawer-carrinho" role="dialog" aria-label="Carrinho de compras" aria-modal="true">
    <header class="nav">
      <strong>Seu carrinho</strong>
      <button class="btn" id="fechar-carrinho">Fechar</button>
    </header>
    <div class="items" id="cart-items"></div>
    <div class="totals">
      <span>Total</span>
      <strong id="cart-total">R$ 0,00</strong>
    </div>
    <div style="padding:14px;display:flex;gap:10px">
      <button class="btn" id="btn-limpar">Esvaziar</button>
      <button class="btn btn-primary" id="btn-checkout">Finalizar compra</button>
    </div>
  </aside>

  <!-- Perfil (cliente) & Admin -->
  <section class="section container" id="perfil" style="display:none">
    <h2>Meu perfil</h2>
    <div class="board">
      <div class="card"><div class="card-content">
        <h3>Minhas compras</h3>
        <div id="minhas-compras" class="note">Nenhuma compra ainda.</div>
      </div></div>
      <div class="card"><div class="card-content">
        <h3>Meus agendamentos</h3>
        <div id="meus-agendamentos" class="note">Nenhum agendamento ainda.</div>
      </div></div>
    </div>
  </section>

  <section class="section container" id="admin" style="display:none">
    <h2>Painel do administrador</h2>
    <div class="board">
      <div class="card"><div class="card-content">
        <h3>Todos os agendamentos</h3>
        <div id="admin-agendamentos" class="note">Nenhum agendamento.</div>
      </div></div>
      <div class="card"><div class="card-content">
        <h3>Todas as compras</h3>
        <div id="admin-compras" class="note">Nenhuma compra.</div>
      </div></div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="grid">
        <div class="col-6">
          <strong>Loja Tech</strong>
          <div class="note">CNPJ 00.000.000/0001-00 • Rua Exemplo, 123 — Centro</div>
          <div class="note">Atendimento: seg–sex 09:00–18:00, sáb 09:00–13:00</div>
        </div>
        <div class="col-6" style="text-align:right">
          <div class="note">© <span id="ano"></span> Loja Tech — Todos os direitos reservados</div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // ======= Proteção de rota: exige login =======
    let usuarioLogado = JSON.parse(localStorage.getItem('usuarioLogado')||'null');
    if(!usuarioLogado){ window.location.href = 'login.html'; }

    // ======= Dados de exemplo =======
    const produtos = [
      { id: 'ntb-01', nome: 'Notebook Pro 15" i7 16GB 512GB SSD', preco: 5499.90, antigo: 5999.90, rating: 4.8, categoria: 'notebooks' },
      { id: 'smr-01', nome: 'Smartphone XZ 256GB 5G', preco: 2999.00, antigo: 3499.00, rating: 4.6, categoria: 'smartphones' },
      { id: 'hed-01', nome: 'Headset Gamer 7.1 Surround', preco: 349.90, antigo: 499.90, rating: 4.7, categoria: 'perifericos' },
      { id: 'ssd-01', nome: 'SSD NVMe 1TB Gen4', preco: 499.90, antigo: 699.90, rating: 4.9, categoria: 'armazenamento' },
      { id: 'rtr-01', nome: 'Roteador Wi‑Fi 6 AX3000', preco: 599.00, antigo: 799.00, rating: 4.5, categoria: 'redes' },
      { id: 'mnr-01', nome: 'Monitor 27" QHD 165Hz', preco: 1899.00, antigo: 2199.00, rating: 4.7, categoria: 'perifericos' },
      { id: 'mou-01', nome: 'Mouse Sem Fio Ergonomico', preco: 149.90, antigo: 199.90, rating: 4.4, categoria: 'perifericos' },
      { id: 'kb-01', nome: 'Teclado Mecânico RGB', preco: 299.90, antigo: 399.90, rating: 4.6, categoria: 'perifericos' },
    ];

    // ======= Utilitários =======
    const R$ = (n) => n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    // ======= Render de Produtos =======
    const grid = document.getElementById('prod-grid');
    function iconeProduto(){
      return `<svg width="120" height="80" viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg">
        <defs><linearGradient id="p" x1="0" x2="1"><stop offset="0%" stop-color="#7c3aed"/><stop offset="100%" stop-color="#6ee7f9"/></linearGradient></defs>
        <rect x="6" y="10" width="108" height="60" rx="10" fill="url(#p)" opacity=".18" stroke="rgba(255,255,255,.25)"/>
        <rect x="12" y="16" width="96" height="36" rx="8" fill="url(#p)" opacity=".35"/>
        <rect x="40" y="56" width="40" height="6" rx="3" fill="rgba(255,255,255,.6)"/>
      </svg>`;
    }

    function cardProduto(p){
      const el = document.createElement('article');
      el.className = 'card col-3 fade-in';
      el.dataset.nome = p.nome.toLowerCase();
      el.dataset.categoria = p.categoria;
      el.innerHTML = `
        <div class="card-media">${iconeProduto()}</div>
        <div class="card-content">
          <div style="display:flex;justify-content:space-between;gap:8px;align-items:start">
            <strong>${p.nome}</strong>
            <span class="rating" aria-label="${p.rating} de 5">★ ${p.rating}</span>
          </div>
          <div>
            <span class="price">${R$(p.preco)}</span>
            <span class="old-price">${R$(p.antigo)}</span>
          </div>
          <div class="actions">
            <button class="btn" onclick='addCarrinho(${JSON.stringify(p.id)})'>Adicionar</button>
            <button class="btn" onclick='comprarAgora(${JSON.stringify(p.id)})'>Comprar</button>
          </div>
        </div>`;
      return el;
    }

    function renderProdutos(list){
      grid.innerHTML = '';
      list.forEach(p => grid.appendChild(cardProduto(p)));
    }

    renderProdutos(produtos);

    // ======= Busca & Categoria =======
    const busca = document.getElementById('busca');
    const botoesCategorias = document.getElementById('botoes-categorias');
    let filtroCategoria = 'todos';

    function aplicarFiltros(){
      const q = (busca.value||'').toLowerCase();
      const filtrados = produtos.filter(p => {
        const matchTexto = p.nome.toLowerCase().includes(q);
        const matchCat = filtroCategoria==='todos' || p.categoria===filtroCategoria;
        return matchTexto && matchCat;
      });
      renderProdutos(filtrados);
    }

    busca.addEventListener('input', aplicarFiltros);
    botoesCategorias.addEventListener('click', (e)=>{
      if(e.target.matches('[data-cat]')){
        filtroCategoria = e.target.dataset.cat;
        aplicarFiltros();
      }
    });

    // Atalhos de navegação
    document.getElementById('btn-servicos').addEventListener('click', ()=>{
      document.getElementById('servicos').scrollIntoView({behavior:'smooth'});
    });
    document.getElementById('btn-categorias').addEventListener('click', ()=>{
      document.getElementById('categorias').scrollIntoView({behavior:'smooth'});
    });

    // ======= Carrinho =======
    const drawer = document.getElementById('drawer-carrinho');
    const cartItems = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const cartTotal = document.getElementById('cart-total');

    let carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');

    function salvarCarrinho(){ localStorage.setItem('carrinho', JSON.stringify(carrinho)); }

    function addCarrinho(id){
      const prod = produtos.find(p => p.id === id);
      const item = carrinho.find(i => i.id === id);
      if(item) item.qtd += 1; else carrinho.push({ id: prod.id, nome: prod.nome, preco: prod.preco, qtd: 1 });
      atualizarCarrinho();
      abrirCarrinho();
    }

    function removerItem(id){
      carrinho = carrinho.filter(i => i.id !== id);
      atualizarCarrinho();
    }

    function alterarQtd(id, delta){
      const item = carrinho.find(i => i.id === id);
      if(!item) return;
      item.qtd += delta;
      if(item.qtd <= 0) removerItem(id); else atualizarCarrinho();
    }

    function total(){ return carrinho.reduce((s,i)=> s + i.preco * i.qtd, 0); }

    function atualizarCarrinho(){
      cartItems.innerHTML = '';
      carrinho.forEach(i => {
        const el = document.createElement('div');
        el.className = 'cart-item';
        el.innerHTML = `
          <div style="width:48px;height:48px;border-radius:10px;background:rgba(255,255,255,.06);display:grid;place-items:center">🛒</div>
          <div class="meta">
            <div style="font-weight:600">${i.nome}</div>
            <div class="note">${R$(i.preco)} • Qtd: ${i.qtd}</div>
          </div>
          <div style="display:flex;gap:6px">
            <button class="btn" title="Diminuir" onclick='alterarQtd(${JSON.stringify(i.id)}, -1)'>−</button>
            <button class="btn" title="Aumentar" onclick='alterarQtd(${JSON.stringify(i.id)}, 1)'>+</button>
            <button class="btn" title="Remover" onclick='removerItem(${JSON.stringify(i.id)})'>×</button>
          </div>`;
        cartItems.appendChild(el);
      });
      cartCount.textContent = carrinho.reduce((s,i)=> s + i.qtd, 0);
      cartTotal.textContent = R$(total());
      salvarCarrinho();
    }

    function abrirCarrinho(){ drawer.classList.add('open'); }
    function fecharCarrinho(){ drawer.classList.remove('open'); }

    document.getElementById('btn-carrinho').addEventListener('click', abrirCarrinho);
    document.getElementById('fechar-carrinho').addEventListener('click', fecharCarrinho);
    document.getElementById('btn-limpar').addEventListener('click', ()=>{ carrinho = []; atualizarCarrinho(); });

    function checkout(){
      if(!carrinho.length){ alert('Seu carrinho está vazio.'); return; }
      if(!usuarioLogado){ window.location.href = 'login.html'; return; }
      const compras = JSON.parse(localStorage.getItem('compras')||'[]');
      const order = {
        id: crypto.randomUUID(),
        usuario: usuarioLogado.email,
        itens: carrinho.map(i=>({id:i.id,nome:i.nome,preco:i.preco,qtd:i.qtd})),
        total: total(),
        data: new Date().toISOString()
      };
      compras.push(order);
      localStorage.setItem('compras', JSON.stringify(compras));
      alert('Compra finalizada! Total: '+ R$(order.total));
      carrinho = []; atualizarCarrinho(); fecharCarrinho();
      carregarPerfil();
      if(usuarioLogado.tipo==='admin') carregarAdmin();
    }

    document.getElementById('btn-checkout').addEventListener('click', checkout);

    atualizarCarrinho();

    // ======= Agendamento =======
    const agendaKey = 'agendamentos';
    let agendamentos = JSON.parse(localStorage.getItem(agendaKey) || '[]');
    function salvarAgendamentos(){ localStorage.setItem(agendaKey, JSON.stringify(agendamentos)); }
    function horarioValido(dataISO, hora){
      const d = new Date(dataISO + 'T' + hora);
      const dia = d.getDay();
      const h = d.getHours();
      return dia !== 0 && h >= 9 && h <= 18;
    }
    function existeConflito(dataISO, hora){
      return agendamentos.some(a => a.data === dataISO && a.hora === hora);
    }
    const form = document.getElementById('form-agendamento');
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const servico = document.getElementById('tipo-servico').value;
      const disp = document.getElementById('dispositivo').value.trim();
      const data = document.getElementById('data').value;
      const hora = document.getElementById('hora').value;
      const nome = document.getElementById('nome').value.trim();
      const email = document.getElementById('email').value.trim();
      const telefone = document.getElementById('telefone').value.trim();
      const detalhes = document.getElementById('detalhes').value.trim();

      if(!horarioValido(data, hora)){
        alert('Selecione um horário válido (seg–sáb, 09:00–18:00).');
        return;
      }
      if(existeConflito(data, hora)){
        alert('Já existe um agendamento para este horário.');
        return;
      }

      const usuarioEmail = usuarioLogado?.email || email;
      const novo = { id: crypto.randomUUID(), servico, disp, data, hora, nome, email: usuarioEmail, telefone, detalhes };
      agendamentos.push(novo);
      salvarAgendamentos();
      renderAgendamentos();
      form.reset();
      alert('Agendamento confirmado!');
      carregarPerfil();
      if(usuarioLogado?.tipo==='admin') carregarAdmin();
    });

    function renderAgendamentos(){
      const box = document.getElementById('lista-agendamentos');
      if(!agendamentos.length){ box.textContent = 'Nenhum agendamento ainda.'; return; }
      const ul = document.createElement('ul');
      ul.style.listStyle = 'none'; ul.style.padding = '0';
      agendamentos
        .sort((a,b)=> (a.data+a.hora).localeCompare(b.data+b.hora))
        .forEach(a => {
          const li = document.createElement('li');
          li.style.marginBottom = '10px';
          li.innerHTML = `<strong>${a.data} • ${a.hora}</strong> — ${a.servico} (${a.disp})<br/><span class="note">Cliente: ${a.nome} — ${a.email || ''}</span> <button class="btn" style="margin-left:6px" onclick='cancelarAg(${JSON.stringify(a.id)})'>Cancelar</button>`;
          ul.appendChild(li);
        });
      box.innerHTML = '';
      box.appendChild(ul);
    }

    function cancelarAg(id){
      agendamentos = agendamentos.filter(a => a.id !== id);
      salvarAgendamentos();
      renderAgendamentos();
      carregarPerfil();
      if(usuarioLogado?.tipo==='admin') carregarAdmin();
    }

    document.getElementById('btn-limpar-ag').addEventListener('click', ()=>{
      if(confirm('Deseja limpar todos os agendamentos?')){
        agendamentos = []; salvarAgendamentos(); renderAgendamentos(); carregarPerfil(); if(usuarioLogado?.tipo==='admin') carregarAdmin();
      }
    });

    // Exportação básica .ics (calendário)
    function gerarICS(){
      const lines = [
        'BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//Loja Tech//Agendamentos//PT-BR'];
      agendamentos.forEach(a => {
        const dt = new Date(a.data + 'T' + a.hora);
        const dtStart = dt.toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z';
        const dtEnd = new Date(dt.getTime()+60*60*1000).toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z';
        lines.push('BEGIN:VEVENT');
        lines.push('UID:' + a.id);
        lines.push('DTSTAMP:' + dtStart);
        lines.push('DTSTART:' + dtStart);
        lines.push('DTEND:' + dtEnd);
        lines.push('SUMMARY:' + a.servico + ' — ' + a.disp);
        lines.push('DESCRIPTION:Cliente ' + a.nome + (a.detalhes? (' — ' + a.detalhes.replace(/\n/g,' ')) : ''));
        lines.push('END:VEVENT');
      });
      lines.push('END:VCALENDAR');
      const blob = new Blob([lines.join('\n')], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'agendamentos.ics'; a.click();
      URL.revokeObjectURL(url);
    }
    document.getElementById('btn-exportar').addEventListener('click', gerarICS);

    // ======= Perfil & Admin (listas) =======
    function carregarPerfil(){
      if(!usuarioLogado){ document.getElementById('perfil').style.display='none'; return; }
      document.getElementById('perfil').style.display='block';
      const compras = JSON.parse(localStorage.getItem('compras')||'[]').filter(c=>c.usuario===usuarioLogado.email);
      const meusAg = (JSON.parse(localStorage.getItem(agendaKey)||'[]')).filter(a=>a.email===usuarioLogado.email);

      const boxC = document.getElementById('minhas-compras');
      if(!compras.length){ boxC.textContent = 'Nenhuma compra ainda.'; }
      else {
        boxC.innerHTML = compras.map(o=>{
          const itens = o.itens.map(i=> `${i.qtd}× ${i.nome}`).join(', ');
          return `<div class="pill" style="display:block;margin-bottom:6px">Pedido ${o.id.slice(0,8)} — ${new Date(o.data).toLocaleString('pt-BR')} — ${itens} • <strong>${R$(o.total)}</strong></div>`;
        }).join('');
      }

      const boxA = document.getElementById('meus-agendamentos');
      if(!meusAg.length){ boxA.textContent = 'Nenhum agendamento ainda.'; }
      else {
        boxA.innerHTML = meusAg.map(a=> `<div class="pill" style="display:block;margin-bottom:6px">${a.data} • ${a.hora} — ${a.servico} (${a.disp})</div>`).join('');
      }
    }

    function carregarAdmin(){
      if(!(usuarioLogado && usuarioLogado.tipo==='admin')){ document.getElementById('admin').style.display='none'; return; }
      document.getElementById('admin').style.display='block';
      const compras = JSON.parse(localStorage.getItem('compras')||'[]');
      const ags = JSON.parse(localStorage.getItem(agendaKey)||'[]');
      const boxC = document.getElementById('admin-compras');
      boxC.innerHTML = compras.length ? compras.map(o=>{
        const itens = o.itens.map(i=> `${i.qtd}× ${i.nome}`).join(', ');
        return `<div class="pill" style="display:block;margin-bottom:6px">${o.usuario} — Pedido ${o.id.slice(0,8)} — ${new Date(o.data).toLocaleString('pt-BR')} — ${itens} • <strong>${R$(o.total)}</strong></div>`;
      }).join('') : 'Nenhuma compra.';

      const boxA = document.getElementById('admin-agendamentos');
      boxA.innerHTML = ags.length ? ags.sort((a,b)=> (a.data+a.hora).localeCompare(b.data+b.hora)).map(a=>
        `<div class="pill" style="display:block;margin-bottom:6px">${a.data} • ${a.hora} — ${a.servico} (${a.disp}) — <strong>${a.nome}</strong> &lt;${a.email}&gt;</div>`
      ).join('') : 'Nenhum agendamento.';
    }

    // Botões Perfil/Admin
    const btnPerfil = document.getElementById('btn-perfil');
    const btnAdmin = document.getElementById('btn-admin');
    btnPerfil.addEventListener('click', ()=>{
      document.getElementById('perfil').scrollIntoView({behavior:'smooth'});
    });
    btnAdmin.addEventListener('click', ()=>{
      document.getElementById('admin').scrollIntoView({behavior:'smooth'});
    });

    // Ano no footer
    document.getElementById('ano').textContent = new Date().getFullYear();

    // Data mínima hoje no agendamento
    const hoje = new Date();
    const yyyy = hoje.getFullYear();
    const mm = String(hoje.getMonth()+1).padStart(2,'0');
    const dd = String(hoje.getDate()).padStart(2,'0');
    document.getElementById('data').min = `${yyyy}-${mm}-${dd}`;

    // Inicialização de UI conforme tipo de usuário
    function atualizarUIAuth(){
      document.getElementById('btn-perfil').style.display = usuarioLogado ? 'inline-block' : 'none';
      document.getElementById('btn-admin').style.display = (usuarioLogado && usuarioLogado.tipo==='admin') ? 'inline-block' : 'none';
    }

    // Sair
    document.getElementById('btn-sair').addEventListener('click', ()=>{
      localStorage.removeItem('usuarioLogado');
      window.location.href = 'login.html';
    });

    // Render inicial de agendamentos globais e áreas
    renderAgendamentos();
    atualizarUIAuth();
    if(usuarioLogado){ carregarPerfil(); if(usuarioLogado.tipo==='admin') carregarAdmin(); }
  </script>
</body>
</html>

